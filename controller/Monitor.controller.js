sap.ui.define(["sap/tl/ewm/lib/reuse/controllers/Base.controller","prodrive/EWM_DECON_MONITOR/model/formatter"],function(e,t){"use strict";return e.extend("prodrive.EWM_DECON_MONITOR.controller.Monitor",{onInit:function(){e.prototype.onInit.apply(this,arguments);var t=this;this.triggerCounter=0;this.intervalTrigger=new sap.ui.core.IntervalTrigger(0);this.intervalTrigger.addListener(function(){t.refreshModel()});var r=function(){this.getOwnerComponent().getModel().read("/UserDefaultsSet(UserName='')",{success:function(e){t.triggerCounter=0;t.intervalTrigger.setInterval(e.RefreshIntervalSeconds*1e3)}})}.bind(this);this.getOwnerComponent().getModel().metadataLoaded().then(r,r)},refreshModel:function(){this.triggerCounter+=1;if(this.triggerCounter>1){this.getOwnerComponent().getModel().refresh(true)}},onExit:function(){this.intervalTrigger.setInterval(0)},onFilterbarFilterChange:function(e){this.intervalTrigger.setInterval(0)},onHULinkPress:function(e){var t=e.getSource().getBindingContext().getObject().HandlingUnitId;var r=e.getSource().getBindingContext().getObject().WarehouseNumber;this._openHandlingUnit(t,r)},onHUIdentPress:function(e){var t=e.getSource().getBindingContext().getObject().Huident;var r=e.getSource().getBindingContext().getObject().WarehouseNumber;this._openHandlingUnit(t,r)},_openHandlingUnit:function(e,t){var r={HandlingUnitId:e,WarehouseNumber:t};this.navigateToObject("EWMHandlingUnit","displaySingle",r)},onDocumentIdLinkPress:function(e){var t=e.getSource().getBindingContext().getObject().DocumentGuid;var r=e.getSource().getBindingContext().getObject().WarehouseNumber;var i=e.getSource().getBindingContext().getObject().DocumentCategory;var n={WarehouseNumber:r,DocumentCategory:i,DocumentGuid:t};this.navigateToObject("Z_EWM_DECON_MON","displayRefDocument",n)},onWarehouseTaskLinkPress:function(e){var t=e.getSource().getBindingContext().getObject().WarehouseTask;var r=e.getSource().getBindingContext().getObject().WarehouseNumber;var i={WarehouseNumber:r,WarehouseTask:t};this.navigateToObject("EWMWarehouseTask","displaySingle",i)},navigateToObject:function(e,t,r){var i=this.getCrossAppNav();var n=i.hrefForExternal({target:{semanticObject:e,action:t},params:r});i.toExternal({target:{shellHash:n}})},onFilterBarGo:function(e){var t=this.getView().byId("idStorageBinTable").getTable();if(t){t.removeSelections()}this.triggerCounter=0;var r=this.getView().getModel().getObject("/UserDefaultsSet('')");if(this.intervalTrigger&&r){this.intervalTrigger.setInterval(r.RefreshIntervalSeconds*1e3)}},_processBinSelectionSmartTable:function(e){var t=this.getView().byId("idStorageBinTable").getTable();var r=t.getSelectedContexts();if(r[0]){e.getParameters().bindingParams.filters.push(new sap.ui.model.Filter("DocumentGuid","EQ",r[0].getObject().DocumentGuid));e.getParameters().bindingParams.filters.push(new sap.ui.model.Filter("ConsolidationGroup","EQ",r[0].getObject().ConsolidationGroup));e.getParameters().bindingParams.filters.push(new sap.ui.model.Filter("DocumentCategory","EQ",r[0].getObject().DocumentCategory));e.getParameters().bindingParams.filters.push(new sap.ui.model.Filter("DocumentType","EQ",r[0].getObject().DocumentType))}},_skipFilterBarFiltersSmartTable:function(e){var t=e.getSource().getModel().getMetaModel();var r=e.getParameters().bindingParams.filters.length;while(r--){var i=e.getParameters().bindingParams.filters[r];var n=i.aFilters.length;while(n--){var a=i.aFilters[n];if(a._bMultiFilter===true){var o=a.aFilters[0].sPath}else if(a._bMultiFilter===false){o=a.sPath}var s=t.getODataEntitySet(e.getSource().getEntitySet());var g=t.getODataEntityType(s.entityType);if(o&&!g||!t.getODataProperty(g,o)){i.aFilters.splice(n,1)}}if(i.aFilters.length===0){e.getParameters().bindingParams.filters.splice(r,1)}}},onBeforeRebindOpenTaskTable:function(e){this._skipFilterBarFiltersSmartTable(e);this._processBinSelectionSmartTable(e)},onBeforeRebindDecoStockTable:function(e){this._skipFilterBarFiltersSmartTable(e);this._processBinSelectionSmartTable(e)},onMasterSelectionChange:function(e){this.getView().byId("idOpenTaskTable").rebindTable();this.getView().byId("idDecoStockTable").rebindTable()},getCrossAppNav:function(){return sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation")}})});